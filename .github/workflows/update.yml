name: Update README (Weekdays Only)

permissions:
  contents: write

on:
  schedule:
    # 2:30 PM ‚Äì 3:00 PM IST (09:00‚Äì09:30 UTC)
    - cron: "30-59 9 * * *"

jobs:
  update-readme:
    runs-on: ubuntu-latest

    env:
      TZ: Asia/Kolkata

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # üîí GATEKEEPER STEP
      - name: Check weekday & Indian holidays
        id: gate
        run: |
          TODAY=$(date +"%Y-%m-%d")
          DAY=$(date +%u)

          echo "IST Date: $TODAY"
          echo "IST Day: $DAY"

          # Default: DO NOT PROCEED
          echo "PROCEED=false" >> $GITHUB_ENV

          # Weekend check
          if [ "$DAY" -eq 6 ] || [ "$DAY" -eq 7 ]; then
            echo "Weekend detected. Stopping workflow."
            exit 0
          fi

          # Indian public holidays
          HOLIDAYS=(
            "2026-01-26"
            "2026-01-28"
            "2026-02-03"
            "2026-02-17"
            "2026-02-24"
            "2026-03-06"
            "2026-03-11"
            "2026-03-23"
            "2026-03-31"
            "2026-04-14"
            "2026-04-15"
            "2026-05-01"
            "2026-08-15"
            "2026-10-02"
            "2026-10-20"
            "2026-12-25"
          )

          for holiday in "${HOLIDAYS[@]}"; do
            if [ "$TODAY" = "$holiday" ]; then
              echo "Indian public holiday detected. Stopping workflow."
              exit 0
            fi
          done

          # ‚úÖ All checks passed
          echo "PROCEED=true" >> $GITHUB_ENV
          echo "All checks passed. Proceeding."

      # ‚è± Random delay (ONLY if allowed)
      - name: Random delay
        if: env.PROCEED == 'true'
        run: |
          DELAY=$((RANDOM % 1800))
          sleep $DELAY

      # ‚úèÔ∏è Update README (ONLY if allowed)
      - name: Update README
        if: env.PROCEED == 'true'
        run: |
          TODAY_HUMAN=$(date +"%d %b %Y")
          sed -i "62s/.*/No updates so far as of $TODAY_HUMAN/" README.md

      # üíæ Commit & push (ONLY if allowed)
      - name: Commit and push changes
        if: env.PROCEED == 'true'
        run: |
          git config user.name "Kousikx"
          git config user.email "kousikx300@gmail.com"

          git add README.md
          git commit -m "chore: daily README update"
          git push
